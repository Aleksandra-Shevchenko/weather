!function(){"use strict";var t={photoTown:document.querySelector(".container__pic"),mainCity:document.querySelector(".city"),temperature:document.querySelector(".city__tem"),cityName:document.querySelector(".city__name"),weatherDesc:document.querySelector(".city__descrip-weather"),weatherIcon:document.querySelector(".city__icon-weather"),cityDate:document.querySelector(".city__date"),addInfo:document.querySelector(".add-info"),searchForm:document.querySelector(".add-info__form"),temFeelsLike:document.querySelector(".add-info__data_type_feels"),wind:document.querySelector(".add-info__data_type_wind"),humidity:document.querySelector(".add-info__data_type_humidity"),userCity:document.querySelector(".add-info__list-el_type_main"),precipitation:document.querySelector(".add-info__data_type_precipitation"),forDate:{days:["ВС","ПН","ВТ","СР","ЧТ","ПТ","СБ"],months:["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"]}};function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var n,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._keyWeather="14926d4323273168c22be818f4f8b491",this._mainUrl="https://api.openweathermap.org/data/2.5/weather?",this._keyPhoto="19932890-3440ea8c759315d97a3ef428e",this._photoUrl="https://pixabay.com/api/?key="}var n,o;return n=t,(o=[{key:"getLocation",value:function(){return fetch("https://ipapi.co/json/").then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getWeather",value:function(t,e){return fetch("".concat(this._mainUrl,"lat=").concat(t,"&lon=").concat(e,"&units=metric&appid=").concat(this._keyWeather,"&lang=ru")).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getAnotherWeather",value:function(t){return fetch("".concat(this._mainUrl,"q=").concat(t,"&units=metric&appid=").concat(this._keyWeather,"&lang=ru")).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getPhoto",value:function(t){var e=t.name,n=t.weather;return fetch("".concat(this._photoUrl).concat(this._keyPhoto,"&q=").concat(e,"+city+").concat(n[0].main,"&lang=ru&image_type=photo&orientation=horizontal&category=places")).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getOtherPhoto",value:function(t){return fetch("".concat(this._photoUrl).concat(this._keyPhoto,"&q=").concat(t,"+weather&lang=ru&image_type=photo&orientation=horizontal&category=backgrounds")).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}},{key:"getPhotoOnlyCity",value:function(t){var e=t.name;return fetch("".concat(this._photoUrl).concat(this._keyPhoto,"&q=").concat(e,"+city&lang=ru&image_type=photo&orientation=horizontal&category=places")).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}}])&&e(n.prototype,o),t}();function c(t,e){var n=document.createElement("script");n.onload=function(){ymaps.ready((function(){return a(t,e)}))},n.id="ymaps",n.src="https://api-maps.yandex.ru/2.1/?apikey=8d35dcd4-01c9-4da3-ac23-1daa50fa2b8c&lang=ru_RU",document.head.append(n)}function a(t,e){n=new ymaps.Map("map",{center:[t,e],zoom:8,controls:[]});var o=new ymaps.GeoObject({geometry:{type:"Point",coordinates:[t,e]},properties:{}},{preset:"islands#darkOrangeDotIcon"});n.geoObjects.add(o)}function r(){n.destroy()}function i(e){t.cityName.textContent=e.name,t.temperature.innerHTML=Math.round(e.main.temp)+"&deg;",t.weatherDesc.textContent=e.weather[0].description,t.weatherIcon.src="https://openweathermap.org/img/wn/".concat(e.weather[0].icon,"@2x.png"),t.cityDate.textContent=function(e){var n=new Date(Date.now()+1e3*e.timezone);function o(t){return String(t).length<2?"0".concat(t):t}return"".concat(o(n.getUTCHours()),":").concat(o(n.getUTCMinutes()),"\n  - ").concat(t.forDate.days[n.getDay()],",\n  ").concat(n.getUTCDate(),"\n  ").concat(t.forDate.months[n.getMonth()],"\n  ").concat(n.getUTCFullYear())}(e),t.temFeelsLike.innerHTML=Math.round(e.main.feels_like)+"&deg;",t.wind.textContent="".concat(e.wind.speed," м/с"),t.humidity.textContent="".concat(e.main.humidity,"%"),t.precipitation.textContent=function(t){return t.rain||t.snow?"".concat(t.rain?t.rain["1h"]:t.snow["1h"]," мм"):"0 мм"}(e)}function u(e){t.userCity.textContent=e.name}function h(e){t.photoTown.src=e.hits[0].largeImageURL}function s(t){var e=t.weather[0].main;l.getPhoto(t).then((function(n){0!==n.total?h(n):l.getPhotoOnlyCity(t).then((function(t){h(t)})).catch((function(){l.getOtherPhoto(e).then((function(t){h(t)}))}))})).catch((function(t){console.log(t)}))}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.cityName.textContent;l.getAnotherWeather(e).then((function(e){t.cityName.textContent!==e.name&&(s(e),r(),a(e.coord.lat,e.coord.lon)),i(e)})).catch((function(t){console.log(t)}))}t.searchForm.addEventListener("submit",(function(e){e.preventDefault(),d(document.querySelector(".add-info__input").value),t.searchForm.reset()})),t.addInfo.querySelectorAll(".add-info__list-el").forEach((function(t){t.addEventListener("click",(function(){d(t.textContent)}))}));var l=new o;navigator.geolocation.getCurrentPosition((function(t){c(t.coords.latitude,t.coords.longitude),l.getWeather(t.coords.latitude,t.coords.longitude).then((function(t){s(t),i(t),u(t)})).catch((function(t){console.log(t)}))}),(function(t){!function(t){t.code==t.PERMISSION_DENIED&&l.getLocation().then((function(t){return c(t.latitude,t.longitude),l.getWeather(t.latitude,t.longitude)})).then((function(t){s(t),i(t),u(t)})).catch((function(t){console.log(t)}))}(t)})),setInterval(d,3e4)}();